# 504 타임아웃 에러 해결 가이드

## 현재 상황
- 프론트엔드: 포트 3001에서 실행 중 ✅
- 백엔드: 재시작 필요 ⚠️

## 즉시 해결 방법

### 1단계: 백엔드 재시작 (필수!)

현재 실행 중인 bash 터미널을 찾으세요:
```
터미널 이름: bash
마지막 명령: python back/server.py
```

**백엔드를 재시작하세요:**
1. bash 터미널을 클릭
2. `Ctrl+C`를 눌러 서버 중지
3. 다음 명령어 실행:
```bash
python back/server.py
```

### 2단계: 브라우저 페이지 새로고침
- 브라우저에서 `F5` 또는 `Ctrl+R` 눌러 새로고침

### 3단계: 테스트
1. "입어보기" 버튼 클릭
2. 5초 카운트다운 대기
3. **즉시** "처리를 시작했습니다" 알림 확인 ✅

## 변경사항 요약

### 백엔드 (back/routes/clothes.py)
- ✅ `subprocess.Popen()` 사용 (백그라운드 실행)
- ✅ 파일 저장 후 즉시 응답 반환 (1-2초)

### 프론트엔드 (front/src/setupProxy.js)
- ✅ 프록시 타임아웃 5분으로 증가

### 프론트엔드 (front/src/Component/main.js)
- ✅ Fetch API 타임아웃 5분 추가
- ✅ AbortController 사용

## 동작 방식 (변경 후)

```
입어보기 클릭
    ↓
5초 카운트다운
    ↓
이미지 캡처 및 전송
    ↓
서버: 파일 저장 (1초)
    ↓
서버: 즉시 응답 반환 ✅
    ↓
프론트: "처리 시작" 알림
    ↓
(백그라운드) main.py 실행 중...
    ↓
(백그라운드) 처리 완료!
```

## 예상 결과

### 성공 시
- 5초 카운트다운 후 즉시 알림: "입어보기 처리를 시작했습니다!"
- 백엔드 콘솔 로그:
  ```
  [clothes.py] POST /api/fit 요청
  [clothes.py] 파일 저장 완료: C:\...\model_20251020_123456.jpg
  [clothes.py] main.py 백그라운드 실행 시작 (PID: 12345)
  ```

### 여전히 504 에러 발생 시
**원인:** 백엔드가 업데이트된 코드로 재시작되지 않았습니다.

**해결:**
1. bash 터미널 찾기
2. `Ctrl+C`로 백엔드 중지
3. `python back/server.py` 재실행
4. 다음 메시지 확인:
   ```
   [server.py] AI 모델 초기화 중...
   * Running on http://127.0.0.1:5000
   ```

## 파일 저장 위치 확인

처리된 이미지는 다음 위치에 저장됩니다:
```
C:\Users\parkj\Desktop\Smart_Closet\back\fit\input\
├── model.jpg                    (main.py가 사용)
└── model_20251020_HHMMSS.jpg   (백업용 타임스탬프)
```

## 문제 해결 체크리스트

- [ ] 백엔드를 `Ctrl+C`로 중지했습니다
- [ ] `python back/server.py`로 재시작했습니다
- [ ] 브라우저를 새로고침했습니다 (F5)
- [ ] "입어보기" 버튼을 클릭했습니다
- [ ] 1-2초 내에 알림이 표시되었습니다 ✅

## 추가 확인 사항

### 백엔드 콘솔에서 확인
```
[clothes.py] POST /api/fit 요청
[clothes.py] 이미지 크기: XXXXX bytes
[clothes.py] 디코딩 완료: XXXXX bytes
[clothes.py] 파일 저장 완료: C:\...\model_YYYYMMDD_HHMMSS.jpg
[clothes.py] main.py 백그라운드 실행 시작 (PID: XXXXX)
```

### 프론트엔드 콘솔 (F12 → Console)
```
[프론트] 입어보기 이미지 업로드 시작
[프론트] 입어보기 처리 응답: {success: true, status: "processing", ...}
```

## 요약

**가장 중요한 것: 백엔드 재시작!**

현재 실행 중인 백엔드는 업데이트 전의 코드입니다. 
반드시 재시작해야 변경사항이 적용됩니다!

```bash
# bash 터미널에서
Ctrl+C  # 중지
python back/server.py  # 재시작
```
