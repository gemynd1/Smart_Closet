# 504 타임아웃 에러 해결 완료

## 문제
- 입어보기 기능 실행 시 `504 Gateway Timeout` 에러 발생
- main.py 실행 시간이 30초를 초과하여 타임아웃 발생

## 해결 방법

### 1. 백엔드 변경 (back/routes/clothes.py)
- `subprocess.run()` → `subprocess.Popen()`으로 변경
- **백그라운드 실행**: main.py를 기다리지 않고 즉시 응답 반환
- 타임스탬프가 포함된 파일명으로 저장
- model.jpg에도 복사하여 main.py 호환성 유지

```python
# 기존: 동기 실행 (최대 30초 대기)
result = subprocess.run([sys.executable, main_py_path], timeout=30)

# 변경: 비동기 실행 (즉시 응답)
process = subprocess.Popen([sys.executable, main_py_path], ...)
```

### 2. 프록시 타임아웃 증가 (front/src/setupProxy.js)
- `timeout: 300000` (5분) 추가
- `proxyTimeout: 300000` (5분) 추가

### 3. 프론트엔드 메시지 개선 (front/src/Component/main.js)
- 처리 중 상태 메시지 표시
- 사용자에게 백그라운드 처리 안내

## 재시작 필요

### 1. 프론트엔드 재시작 (setupProxy.js 변경됨)
```powershell
# 기존 프로세스 종료 (Ctrl+C)
# 다시 시작
cd C:\Users\parkj\Desktop\Smart_Closet\front
npm start
```

### 2. 백엔드 재시작 (clothes.py 변경됨)
```powershell
# 기존 프로세스 종료 (Ctrl+C)
# 다시 시작
cd C:\Users\parkj\Desktop\Smart_Closet\back
python server.py
```

## 동작 방식

### 이전 (동기 실행)
```
사용자 클릭 → 5초 카운트다운 → 이미지 전송 
→ 서버가 main.py 완료까지 대기 (30초+) 
→ 504 타임아웃 에러 ❌
```

### 현재 (비동기 실행)
```
사용자 클릭 → 5초 카운트다운 → 이미지 전송 
→ 서버가 파일 저장 후 즉시 응답 (1-2초) ✅
→ main.py는 백그라운드에서 계속 실행 중...
→ 처리 완료 (사용자는 다른 작업 가능)
```

## 장점
1. ✅ 타임아웃 에러 해결
2. ✅ 빠른 응답 (1-2초 내)
3. ✅ 사용자 경험 개선 (대기 시간 없음)
4. ✅ 여러 요청 동시 처리 가능

## 테스트 방법
1. 프론트엔드 및 백엔드 재시작
2. "입어보기" 버튼 클릭
3. 5초 후 자동 캡처
4. 즉시 "처리를 시작했습니다" 알림 확인 ✅
5. 백엔드 콘솔에서 main.py 실행 로그 확인

## 파일 저장 위치
- `back/fit/input/model_YYYYMMDD_HHMMSS.jpg` (타임스탬프 포함)
- `back/fit/input/model.jpg` (main.py가 읽는 기본 파일)
